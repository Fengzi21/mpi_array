language: python
git:
  depth: 200
python:
  - '2.7'
  - '3.3'
  - '3.4'
  - '3.5'
  - '3.6-dev'

sudo: required
os: linux
cache:
  apt: true

env:
  matrix:
    - MPI=openmpi

before_install:
  - sh utils/travis_ci/travis_ci_install_mpi.sh $MPI

install:
  - if [[ $MPI == 'openmpi' ]]; then ompi_info; fi
  - git config --global user.name mpi-array
  - git config --global user.email mpi-array@users.noreply.github.com
  - pip install flake8
  - pip install 'sphinx>=1.4'
  - pip install travis-sphinx
  - pip install coveralls
  - python ./setup.py install

script:
  - flake8 mpi_array
  - coverage run --source=mpi_array --omit='*logging*,*unittest*,*rtd*' -m mpi_array.tests;
  - # run tests on installed mpi_array
  - cd docs
  - python -m mpi_array.tests
  - cd ..
  - if [[ $TRAVIS_PYTHON_VERSION != '3.3'* ]]; then travis-sphinx build; fi

after_success:
  - if [[ $TRAVIS_PYTHON_VERSION != '3.3'* ]]; then travis-sphinx --branches=dev deploy; fi
  - coveralls
